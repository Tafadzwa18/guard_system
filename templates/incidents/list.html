{% extends "base.html" %}
{% block title %}Incidents{% endblock %}
{% block content %}
<h3 class="mb-3">Incident Reports</h3>

<form method="get" class="row g-2 mb-3">
  <div class="col-md-4">
    <input class="form-control" name="site" placeholder="Filter by site" value="{{ request.GET.site }}">
  </div>
  <div class="col-md-4">
    <input class="form-control" name="severity" placeholder="Severity (LOW/MEDIUM/HIGH/CRITICAL)" value="{{ request.GET.severity }}">
  </div>
  <div class="col-md-4">
    <button class="btn btn-outline-primary w-100">Apply</button>
  </div>
</form>

<div class="card shadow-sm">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table align-middle mb-0">
        <thead>
          <tr>
            <th>When</th>
            <th>Severity</th>
            <th>Guard</th>
            <th>Site</th>
            <th>Route</th>
            <th>Title</th>
          </tr>
        </thead>
        <tbody>
          {% for i in incidents %}
          <tr>
            <td>{{ i.created_at }}</td>
            <td><span class="badge bg-dark">{{ i.severity }}</span></td>
            <td>{{ i.session.guard.username }}</td>
            <td>{{ i.session.route.site.name }}</td>
            <td>{{ i.session.route.name }}</td>
            <td>
              <a href="{% url 'incident_detail' i.id %}">{{ i.title }}</a>
              {% if i.checkpoint %}<div class="small text-muted">Checkpoint: {{ i.checkpoint.name }}</div>{% endif %}
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="6" class="text-muted">No incidents found.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
